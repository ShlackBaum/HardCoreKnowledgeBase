# BASIC INSTRUCTION: Архитектура и Эксплуатация Базы Знаний

> **Версия:** 2.0 (Post-MVP, с ботом и транслитерацией)
> **Стек:** GitHub (Storage) + GitBook (Frontend) + Google Apps Script (Telegram Bot)
> **Последнее обновление:** Декабрь 2025

---

## 1. Архитектура Системы

### Принцип "Docs as Code"
Мы не храним знания в визуальном редакторе. **GitHub — единственный источник правды.**
*   `main` — основная ветка. Всё, что попадает сюда, автоматически летит на сайт GitBook.
*   Изменения на сайте (через админку GitBook) нежелательны, так как могут вызвать конфликты.

### Структура папок
Мы поддерживаем "Золотой стандарт" чистоты. Мусорные папки удалены.

```text
/
├── .gitignore          <-- Защита от секретов и бинарников
├── SUMMARY.md          <-- ОГЛАВЛЕНИЕ МЕНЮ (Самый важный файл!)
├── README.md           <-- Главная страница
├── BASIC_INSTRUCTION.md <-- Этот файл
│
├── chaos/              <-- INBOX для бота (сюда падают заметки)
│   └── README.md       <-- Описание раздела
│
├── client-relations/   <-- Взаимодействие с клиентом (PRIVATE)
│   ├── onboarding/
│   ├── reporting/
│   └── finance/
│
├── conversion-cro/     <-- Конверсия
├── link-building/      <-- Ссылочное Google
│   ├── outreach/
│   └── pbn/
├── other/              <-- Разное
├── pf-google/          <-- ПФ Google (R&D)
├── pf-yandex/          <-- ПФ Яндекс
│   ├── strategy/
│   └── software/
├── seo-strategy/       <-- SEO-Стратегия (Ядро)
│   ├── methodology/
│   ├── pre-sale/
│   │   └── deep-research.md <-- Эталонный регламент
│   └── verticals/
├── technical-seo/      <-- Техническое SEO
│   ├── audits/
│   └── indexing/
│
└── tools/              <-- Скрипты автоматизации
    └── google-apps-script-bot/
        ├── code_for_google.js <-- Код бота (для копирования)
        └── INSTRUCTION.md     <-- Инструкция по настройке бота
```

---

## 2. Работа с контентом

### Способ А: "Быстрый вброс" (Telegram Бот) ⚡

Для сохранения идей "на лету" используем бота **@HardCoreKnowledgeAppend_bot**.

#### Как использовать:
*   **Личка:** Пишем любой текст -> Бот сохраняет автоматически.
*   **Группы:** Пишем `@HardCoreKnowledgeAppend_bot Текст идеи...` -> Бот сохраняет только если его тегнули.

#### Что бот понимает:
*   **Форматирование:** Жирный текст (`**текст**`), курсив (`_текст_`), код (`` `код` ``), ссылки (`[текст](url)`).
*   **Встроенные ссылки:** Если вы вставили ссылку в слово в Телеграме, она сохранится как Markdown `[слово](url)`.

#### Логика формирования заголовка:
1.  Бот ищет **первую строку с осмысленным текстом** (пропускает строки, состоящие только из тегов `@user`).
2.  Берет **первые 7 слов** из этой строки (исключая теги, ссылки, скобки).
3.  Это становится **названием заметки в меню**.

#### Формат файлов:
*   **Имя файла:** `dd-mm-yy-translit-title.md` (например: `12-12-25-u-nas-poyavilsya-adres.md`)
*   **Заголовок в меню:** Только текст (7 слов), без даты и автора.
*   **Внутри файла:**
    ```markdown
    # Заголовок заметки
    
    **Дата:** 12.12.2025 14:30
    **Автор:** @username
    
    ---
    
    [Текст заметки с форматированием]
    ```

#### Результат работы бота:
1.  Создается файл в папке `chaos/` с транслитерированным именем.
2.  Автоматически добавляется ссылка в меню `SUMMARY.md` под раздел "ХАОС" (сверху списка).
3.  Бот отвечает: `✅ Сохранено: Заголовок заметки (имя-файла.md)`

#### Что бот НЕ делает:
*   Не реагирует на **правки сообщений** (edited_message игнорируется).
*   Не реагирует на сообщения **без текста** (стикеры, картинки).
*   В группах не реагирует, если его **не тегнули**.

---

### Способ Б: "Редактура" (GitHub) ✏️

Для создания регламентов и правки статей.

#### Процесс:
1.  Заходим в репозиторий на GitHub: [HardCoreKnowledgeBase](https://github.com/ShlackBaum/HardCoreKnowledgeBase)
2.  Находим нужный файл (или создаем новый через `Add file`).
3.  Жмем ✏️ (Edit).
4.  Пишем в Markdown.
5.  **Commit changes** (зеленая кнопка).
    *   Если создали **НОВЫЙ файл** — обязательно добавьте ссылку на него в `SUMMARY.md`, иначе он не появится в меню GitBook!

#### Формат коммитов (рекомендация):
*   `feat: add new audit checklist` — новая фича.
*   `fix: correct typo in deep-research` — исправление.
*   `chore: cleanup chaos folder` — техническая работа.

---

## 3. Автоматизация (Telegram Bot)

Бот работает на **Google Apps Script** (Serverless). Это бесплатно и надежно.

*   **Исходный код:** Лежит в `tools/google-apps-script-bot/code_for_google.js`.
*   **Где крутится:** [script.google.com](https://script.google.com/) (в вашем Google аккаунте).

### Как обновить бота (если поменяли код)?

**КРИТИЧЕСКИ ВАЖНО:** Google Script не обновляет "боевого" бота при простом "Save". Нужно создавать **New Version**.

1.  Скопировать новый код из `code_for_google.js` (Raw версия на GitHub).
2.  Вставить в редактор на script.google.com.
3.  **Вставить свой GITHUB_TOKEN** в строку 2 (старый токен мог быть отозван).
4.  Нажать `Deploy` -> `Manage deployments` -> `Edit` (карандаш).
5.  **В поле Version выбрать: `New version`** (не "Use existing version"!).
6.  Нажать `Deploy`.
7.  Скопировать новый URL и обновить его в функции `setWebhook()` (если URL изменился).
8.  Запустить `setWebhook()` кнопкой Run.

### Секретные ключи (Не палить!)

В скрипте используются два токена. Если они утекут — бот сломается.

1.  **GITHUB_TOKEN:**
    *   Где получить: GitHub -> Settings -> Developer settings -> Personal access tokens -> Tokens (classic).
    *   Права: `repo` (Full control of private repositories).
    *   Если протух — генерируем новый и вставляем в скрипт.
    *   **ВАЖНО:** Если вы прислали токен в чат, GitHub его автоматически отзовет. Не присылайте токены в открытые каналы!

2.  **TELEGRAM_BOT_TOKEN:**
    *   Где получить: @BotFather в Telegram -> `/newbot` -> Получить токен.
    *   Если протух — создаем нового бота или запрашиваем новый токен у BotFather.

---

## 4. Устранение проблем (Troubleshooting)

### Проблема: "На сайте иероглифы вместо текста"
*   **Причина:** Файл сохранен в кодировке Windows (UTF-16/CP1251).
*   **Решение:** Пересохранить файл в **UTF-8**. (Бот делает это автоматически).

### Проблема: "Бот молчит"
1.  Проверьте `Deploy` -> `Executions` в Google Script.
    *   Если `Failed` — смотрите ошибку в логах.
    *   Если `Completed` — значит код выполнился, но ответ не отправился (проблема в функции `reply`).
2.  **Частая причина:** GitHub Token отозван. (GitHub сжигает токены, если находит их в публичном чате).
3.  Сгенерируйте новый токен и обновите скрипт (не забудьте **New Version** при деплое!).

### Проблема: "Бот не видит сообщения в группе"
1.  Идите в @BotFather.
2.  `/mybots` -> Выберите бота -> Settings -> **Group Privacy**.
3.  Выключите (Turn OFF). Должно стать: *"Privacy mode is DISABLED"*.
4.  Удалите бота из чата и добавьте заново (чтобы настройки применились).

### Проблема: "GitBook не обновляется"
1.  Зайдите в настройки GitBook -> Git Sync.
2.  Убедитесь, что ветка стоит **main** (не master).
3.  Нажмите Sync Now.
4.  В крайнем случае: Disconnect -> Connect заново.

### Проблема: "Заголовок в меню состоит из тегов"
*   **Причина:** Первая строка сообщения состояла только из тегов `@user`.
*   **Решение:** Бот уже исправлен — он пропускает строки с тегами и берет первую осмысленную строку. Если проблема повторяется — проверьте, что вы используете последнюю версию кода.

### Проблема: "Файлы называются по-разному (дата-время vs транслит)"
*   **Причина:** Старая версия бота использовала формат `dd-MM-HHmm-user.md`.
*   **Решение:** Обновите код бота до версии с транслитерацией (файл `code_for_google.js` в репозитории).

---

## 5. Технические детали

### Формат имен файлов (Текущая версия)
*   **Шаблон:** `dd-mm-yy-translit-title.md`
*   **Пример:** `12-12-25-u-nas-poyavilsya-adres.md`
*   **Транслитерация:** Русские буквы → латиница (ГОСТ-лайк), пробелы → дефисы, спецсимволы удаляются.

### Структура SUMMARY.md
Файл `SUMMARY.md` — это "карта меню" для GitBook. Он жестко контролирует порядок и видимость разделов.

*   **Формат записи:** `* [Название](путь/к/файлу.md)`
*   **Новые заметки:** Добавляются автоматически ботом под заголовок `## ХАОС (Inbox)`.
*   **Ручное редактирование:** Если вы создали файл вручную, добавьте его в `SUMMARY.md`, иначе он не появится в меню.

### Кодировка файлов
*   **Стандарт:** UTF-8 без BOM.
*   **Проверка:** Если файл открывается с иероглифами в GitBook — значит он в неправильной кодировке.

---

## 6. Полезные ссылки

*   [GitHub Репозиторий](https://github.com/ShlackBaum/HardCoreKnowledgeBase)
*   [Сайт Базы Знаний](https://hardcoreseo.gitbook.io/)
*   [Панель Google Script](https://script.google.com/)
*   [GitHub Tokens (Создание)](https://github.com/settings/tokens/new)
*   [BotFather (Telegram)](https://t.me/BotFather)

---

## 7. Чек-лист для новых сотрудников

Когда к вам присоединяется новый член команды:

1.  ✅ Зарегистрировать на GitHub (если нет аккаунта).
2.  ✅ Добавить в Collaborators репозитория (Settings -> Collaborators -> Add people).
3.  ✅ Дать ссылку на сайт GitBook (для чтения).
4.  ✅ Объяснить, что правки делаются через GitHub (не через GitBook UI).
5.  ✅ Показать бота в Telegram и объяснить логику тегов.

---

**Последнее обновление:** Декабрь 2025  
**Версия документа:** 2.0
